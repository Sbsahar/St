# خطة إعادة هيكلة وتطوير بوت ste.py

بناءً على تحليل الكود الحالي وميزات بوت Group Help، أقترح إعادة هيكلة البوت ليكون أكثر تنظيماً وقابلية للتطوير. سنقوم بتقسيم الملف الضخم `ste.py` إلى وحدات (modules) متخصصة، مما يسهل الصيانة وإضافة الميزات الجديدة.

## 1. البنية المقترحة للملفات

بدلاً من ملف واحد كبير، سنقوم بإنشاء مجلد جديد وليكن `bot_modules` يحتوي على الملفات التالية:

```
St-main/
├── ste.py              # الملف الرئيسي لتشغيل البوت فقط
├── config.py           # لتخزين المتغيرات الحساسة مثل التوكن ومفاتيح API
├── data_manager.py     # لإدارة تحميل وحفظ ملفات JSON (الكلمات المحظورة، رسائل الترحيب، إلخ)
└── bot_modules/
    ├── __init__.py
    ├── admin.py          # أوامر الإدارة (حظر، كتم، تحذير، إلخ)
    ├── moderation.py     # الإشراف التلقائي (حذف الروابط، السبام، المحتوى الإباحي)
    ├── user.py           # الأوامر المتاحة للمستخدمين العاديين (مثل gpt)
    ├── welcome.py        # إدارة رسائل الترحيب والمغادرة
    ├── settings.py       # لوحة التحكم الخاصة بإعدادات المجموعة (/settings)
    └── utils.py          # دوال مساعدة مشتركة (مثل التحقق من المشرف)
```

## 2. تحليل الكود الحالي وتوزيع الوظائف

الكود الحالي في `ste.py` يحتوي على العديد من الوظائف التي سيتم نقلها إلى الوحدات الجديدة:

| الوظيفة في `ste.py` | الوحدة الجديدة المقترحة |
| :--- | :--- |
| `is_user_admin`, `is_developer` | `bot_modules/utils.py` |
| `load_...`, `save_...` (لكل ملفات JSON) | `data_manager.py` |
| أوامر الحظر، الكتم، التحذير | `bot_modules/admin.py` |
| فحص الصور (`check_image_safety`)، فحص الروابط، الكلمات المحظورة | `bot_modules/moderation.py` |
| رسائل الترحيب (`/setwelcome`, `on_new_chat_members`) | `bot_modules/welcome.py` |
| أوامر GPT (`/gbt`, `/opengbt`) | `bot_modules/user.py` |
| الأوامر المتعلقة بالقناة واليوتيوب | ستبقى في وحداتها الحالية (`channel_module.py`, `youtube_module.py`) |

## 3. الميزات الجديدة المستوحاة من Group Help

سنقوم بإضافة الميزات التالية بالتدريج:

1.  **نظام التحذيرات (Warns):**
    *   أمر `/warn` لتحذير المستخدم.
    *   عند الوصول لعدد معين من التحذيرات، يتم اتخاذ إجراء تلقائي (كتم أو حظر).
    *   أمر `/unwarn` لإزالة تحذير.

2.  **لوحة تحكم متكاملة (`/settings`):**
    *   إنشاء لوحة تحكم باستخدام الأزرار (Inline Keyboard) لإدارة إعدادات المجموعة بسهولة بدلاً من الأوامر المتعددة.
    *   ستسمح للمشرفين بتفعيل/تعطيل الميزات (مثل حظر الروابط، رسائل الترحيب) وتعيين العقوبات.

3.  **قناة السجل (Log Channel):**
    *   تسجيل جميع الإجراءات الإدارية (حظر، كتم، تحذير، حذف) في قناة خاصة لضمان الشفافية.

4.  **تحسين حظر الروابط:**
    *   السماح للمشرفين بإرسال الروابط.
    *   إنشاء قائمة بيضاء للروابط المسموح بها.

## خطة العمل

1.  **إنشاء هيكل الملفات الجديد.**
2.  **نقل الكود الحالي** من `ste.py` إلى الوحدات الجديدة مع إجراء التعديلات اللازمة.
3.  **البدء في تنفيذ الميزات الجديدة**، وسنبدأ بنظام التحذيرات ولوحة التحكم.

هل توافق على هذه الخطة؟ إذا كان لديك أي تعديلات أو أولويات أخرى، يمكننا مناقشتها قبل البدء في التنفيذ.
